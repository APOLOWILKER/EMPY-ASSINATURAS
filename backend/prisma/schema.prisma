generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Tabela : Planos
model Plan {
  id              String   @id @default(uuid())
  name            String
  description     String?
  monthlyValue    Decimal? @map("monthly_value")
  annualValue     Decimal? @map("annual_value")
  discountPercent Int?     @map("discount_percent")
  onlineCredits   Int      @map("online_credits")
  offlineCredits  Int      @map("offline_credits")
  isActive        Boolean  @default(true)
  isCustom        Boolean  @default(false)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  subscriptions   Subscription[]
  purchaseHistory PurchaseHistory[]

  @@map("plans")
}

// Table: Users
model User {
  id    String  @id @default(uuid())
  name  String?
  email String? @unique

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt @map("updated_at")

  subscriptions   Subscription[]
  purchaseHistory PurchaseHistory[]

  @@map("users")
}

// Table: Subscriptions
model Subscription {
  id             String             @id @default(uuid())
  userId         String             @map("user_id")
  planId         String             @map("plan_id")
  isMonthly      Boolean            @default(true) @map("is_monthly")
  status         SubscriptionStatus
  startDate      DateTime           @default(now()) @map("start_date")
  endDate        DateTime?          @map("end_date")
  lastChargeDate DateTime?          @map("last_charge_date")
  paymentMethod  String?            @map("payment_method")

  updatedAt DateTime @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id])
  plan Plan @relation(fields: [planId], references: [id])

  @@map("subscriptions")
}

enum SubscriptionStatus {
  ACTIVE
  INACTIVE
  CANCELLED
  PENDING
}

// Table: PurchaseHistory
model PurchaseHistory {
  id              String        @id @default(uuid())
  userId          String        @map("user_id")
  planId          String        @map("plan_id")
  operationType   OperationType @map("operation_type")
  paidValue       Decimal       @map("paid_value")
  paymentStatus   PaymentStatus @map("payment_status")
  transactionDate DateTime      @default(now()) @map("transaction_date")
  receiptUrl      String?       @map("receipt_url")
  notes           String?

  user User @relation(fields: [userId], references: [id])
  plan Plan @relation(fields: [planId], references: [id])

  @@map("purchase_history")
}

// Enum for 'operationType' field in the PurchaseHistory table
enum OperationType {
  PURCHASE
  UPGRADE
  DOWNGRADE
}

// Enum for 'paymentStatus' field in the PurchaseHistory table
enum PaymentStatus {
  PAID
  REJECTED_INSUFFICIENT_FUNDS
  UNAUTHORIZED
  GENERAL_FAILURE
  PENDING
}
